@using WicsPlatform.Server.Models.wics

<RadzenCard class="mt-2 professional-panel">
    <!-- 패널 헤더 -->
    <div @onclick="TogglePanel" class="panel-header">
        <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" JustifyContent="JustifyContent.SpaceBetween">
            <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.375rem">
                <RadzenIcon Icon="monitoring" class="panel-icon success" />
                <RadzenText TextStyle="TextStyle.Body1" class="panel-title">
                    @(Channel?.Name ?? "채널") - 방송 모니터링
                </RadzenText>
                <RadzenBadge BadgeStyle="BadgeStyle.Success" IsPill="true" Text="방송 중" class="status-badge" />
            </RadzenStack>
            <RadzenIcon Icon="@(IsCollapsed ? "expand_more" : "expand_less")" class="expand-icon" />
        </RadzenStack>
    </div>

    <!-- 패널 내용 -->
    @if (!IsCollapsed)
    {
        <div class="panel-content">
            <RadzenStack Gap="0.75rem">
                <!-- 방송 상태 정보 -->
                <RadzenRow Gap="0.5rem">
                    <!-- 활성 소스 표시 -->
                    <RadzenColumn Size="12" SizeMD="4">
                        <RadzenCard class="info-card">
                            <RadzenStack Gap="0.25rem">
                                <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.25rem">
                                    <RadzenIcon Icon="source" class="info-icon" />
                                    <RadzenText TextStyle="TextStyle.Caption" class="info-title">활성 방송 소스</RadzenText>
                                </RadzenStack>
                                <RadzenStack Orientation="Orientation.Horizontal" Gap="0.25rem">
                                    @if (IsMicEnabled)
                                    {
                                        <RadzenBadge BadgeStyle="BadgeStyle.Info" IsPill="true" Text="마이크" class="source-badge" />
                                    }
                                    @if (IsMediaEnabled)
                                    {
                                        <RadzenBadge BadgeStyle="BadgeStyle.Warning" IsPill="true" Text="미디어" class="source-badge" />
                                    }
                                    @if (IsTtsEnabled)
                                    {
                                        <RadzenBadge BadgeStyle="BadgeStyle.Success" IsPill="true" Text="TTS" class="source-badge" />
                                    }
                                </RadzenStack>
                            </RadzenStack>
                        </RadzenCard>
                    </RadzenColumn>

                    <!-- 오디오 레벨 -->
                    @if (IsMicEnabled)
                    {
                        <RadzenColumn Size="12" SizeMD="4">
                            <RadzenCard class="info-card">
                                <RadzenStack Gap="0.25rem">
                                    <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.25rem">
                                        <RadzenIcon Icon="volume_up" class="info-icon" />
                                        <RadzenText TextStyle="TextStyle.Caption" class="info-title">오디오 레벨</RadzenText>
                                    </RadzenStack>
                                    <RadzenProgressBar Value="@AudioLevel" Max="100" class="audio-progress" ProgressBarStyle="ProgressBarStyle.Success" />
                                    <RadzenText TextStyle="TextStyle.Caption" class="info-value">
                                        @AudioLevel.ToString("F1")%
                                    </RadzenText>
                                </RadzenStack>
                            </RadzenCard>
                        </RadzenColumn>
                    }

                    <!-- 방송 시간 -->
                    <RadzenColumn Size="12" SizeMD="4">
                        <RadzenCard class="info-card">
                            <RadzenStack Gap="0.25rem">
                                <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.25rem">
                                    <RadzenIcon Icon="timer" class="info-icon" />
                                    <RadzenText TextStyle="TextStyle.Caption" class="info-title">방송 시간</RadzenText>
                                </RadzenStack>
                                <RadzenText TextStyle="TextStyle.Body1" class="info-main-value">
                                    @BroadcastDuration
                                </RadzenText>
                                <RadzenText TextStyle="TextStyle.Caption" class="info-sub-value">
                                    시작: @BroadcastStartTime.ToString("HH:mm:ss")
                                </RadzenText>
                            </RadzenStack>
                        </RadzenCard>
                    </RadzenColumn>
                </RadzenRow>

                <!-- 데이터 통계 -->
                <RadzenCard class="stats-card">
                    <RadzenStack Gap="0.5rem">
                        <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.25rem">
                            <RadzenIcon Icon="analytics" class="section-icon" />
                            <RadzenText TextStyle="TextStyle.Body2" class="section-title">방송 데이터 통계</RadzenText>
                        </RadzenStack>
                        <RadzenRow Gap="0.5rem">
                            <RadzenColumn Size="6" SizeMD="3">
                                <div class="stat-item">
                                    <RadzenText TextStyle="TextStyle.Body2" class="stat-value">@TotalDataPackets</RadzenText>
                                    <RadzenText TextStyle="TextStyle.Caption" class="stat-label">전송 패킷</RadzenText>
                                </div>
                            </RadzenColumn>
                            <RadzenColumn Size="6" SizeMD="3">
                                <div class="stat-item">
                                    <RadzenText TextStyle="TextStyle.Body2" class="stat-value">@TotalDataSize.ToString("F2") KB</RadzenText>
                                    <RadzenText TextStyle="TextStyle.Caption" class="stat-label">총 데이터량</RadzenText>
                                </div>
                            </RadzenColumn>
                            <RadzenColumn Size="6" SizeMD="3">
                                <div class="stat-item">
                                    <RadzenText TextStyle="TextStyle.Body2" class="stat-value">@AverageBitrate.ToString("F2") kbps</RadzenText>
                                    <RadzenText TextStyle="TextStyle.Caption" class="stat-label">평균 비트레이트</RadzenText>
                                </div>
                            </RadzenColumn>
                            <RadzenColumn Size="6" SizeMD="3">
                                <div class="stat-item">
                                    <RadzenText TextStyle="TextStyle.Body2" class="stat-value">@SampleRate Hz</RadzenText>
                                    <RadzenText TextStyle="TextStyle.Caption" class="stat-label">샘플레이트</RadzenText>
                                </div>
                            </RadzenColumn>
                        </RadzenRow>
                    </RadzenStack>
                </RadzenCard>

                <!-- 방송 제어 버튼들 -->
                <RadzenRow Gap="0.5rem">
                    <RadzenColumn Size="6">
                        <RadzenButton Text="일시정지"
                                      Icon="pause_circle"
                                      ButtonStyle="ButtonStyle.Warning"
                                      Size="ButtonSize.Small"
                                      class="control-button"
                                      Click="@PauseBroadcast" />
                    </RadzenColumn>
                    <RadzenColumn Size="6">
                        <RadzenButton Text="방송 종료"
                                      Icon="stop_circle"
                                      ButtonStyle="ButtonStyle.Danger"
                                      Size="ButtonSize.Small"
                                      class="control-button"
                                      Click="@StopBroadcast" />
                    </RadzenColumn>
                </RadzenRow>

                <!-- 실시간 로그 -->
                <RadzenCard class="log-card">
                    <RadzenStack Gap="0.5rem">
                        <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.25rem">
                            <RadzenIcon Icon="receipt_long" class="section-icon" />
                            <RadzenText TextStyle="TextStyle.Body2" class="section-title">실시간 로그</RadzenText>
                        </RadzenStack>
                        <div class="log-container">
                            @foreach (var log in broadcastLogs.TakeLast(50).Reverse())
                            {
                                <div class="log-entry @GetLogClass(log.Level)">
                                    <span class="log-time">[@log.Timestamp.ToString("HH:mm:ss")]</span>
                                    <span class="log-level">[@log.Level]</span>
                                    <span class="log-message">@log.Message</span>
                                </div>
                            }
                        </div>
                    </RadzenStack>
                </RadzenCard>

                <!-- 마이크 디버깅 패널 (옵션) -->
                @if (IsMicEnabled && showDebugPanel)
                {
                    <RadzenCard class="debug-card">
                        <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" JustifyContent="JustifyContent.SpaceBetween">
                            <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.25rem">
                                <RadzenIcon Icon="bug_report" class="section-icon warning" />
                                <RadzenText TextStyle="TextStyle.Body2" class="section-title">마이크 데이터 디버깅</RadzenText>
                            </RadzenStack>
                            <RadzenSwitch @bind-Value="@showDebugPanel" class="compact-switch" />
                        </RadzenStack>
                    </RadzenCard>
                }
            </RadzenStack>
        </div>
    }
</RadzenCard>

<style>
    /* 전문적인 패널 디자인 */
    .professional-panel {
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05) !important;
        border: 1px solid #dde2e6 !important;
        border-radius: 6px !important;
        background: var(--rz-base-background-color)!important;
        overflow: hidden;
    }

    .panel-header {
        background: #fafbfc;
        padding: 0.625rem 0.875rem;
        cursor: pointer;
        transition: all 0.2s ease;
        border-bottom: 1px solid #e1e4e8;
        user-select: none;
    }

        .panel-header:hover {
            background: #f5f6f8;
        }

    .panel-icon {
        font-size: 1rem !important;
    }

        .panel-icon.success {
            color: #27ae60 !important;
        }

    .panel-title {
        font-size: 0.875rem !important;
        font-weight: 600 !important;
        color: #2c3e50 !important;
        margin: 0 !important;
    }

    .status-badge {
        font-size: 0.65rem !important;
        padding: 2px 6px !important;
    }

    .expand-icon {
        font-size: 1rem !important;
        color: #6c757d !important;
        transition: transform 0.2s ease;
    }

    .panel-content {
        padding: 0.875rem;
        animation: slideDown 0.2s ease-out;
    }

    /* 정보 카드 */
    .info-card {
        padding: 0.625rem !important;
        background: #fafbfc !important;
        border: 1px solid #e1e4e8 !important;
        height: 100%;
    }

    .info-icon {
        font-size: 0.875rem !important;
        color: #3498db !important;
    }

    .info-title {
        font-size: 0.7rem !important;
        font-weight: 500 !important;
        color: #6c757d !important;
        margin: 0 !important;
    }

    .info-main-value {
        font-size: 1rem !important;
        font-weight: 600 !important;
        color: #2c3e50 !important;
        margin: 0 !important;
    }

    .info-value {
        font-size: 0.75rem !important;
        color: #34495e !important;
        margin: 0 !important;
    }

    .info-sub-value {
        font-size: 0.65rem !important;
        color: #6c757d !important;
        margin: 0 !important;
    }

    .source-badge {
        font-size: 0.65rem !important;
        padding: 2px 6px !important;
    }

    .audio-progress {
        height: 14px !important;
    }

    /* 통계 카드 */
    .stats-card {
        padding: 0.75rem !important;
        background: var(--rz-base-background-color)!important;
        border: 1px solid #e1e4e8 !important;
    }

    .section-icon {
        font-size: 0.875rem !important;
        color: #3498db !important;
    }

        .section-icon.warning {
            color: #f39c12 !important;
        }

    .section-title {
        font-size: 0.8rem !important;
        font-weight: 600 !important;
        color: #2c3e50 !important;
        margin: 0 !important;
    }

    .stat-item {
        text-align: center;
        padding: 0.5rem;
        background: #fafbfc;
        border-radius: 4px;
        border: 1px solid #e1e4e8;
    }

    .stat-value {
        font-size: 0.875rem !important;
        font-weight: 600 !important;
        color: #2c3e50 !important;
        margin: 0 !important;
    }

    .stat-label {
        font-size: 0.65rem !important;
        color: #6c757d !important;
        margin: 0 !important;
    }

    /* 제어 버튼 */
    .control-button {
        width: 100% !important;
        height: 30px !important;
        font-size: 0.75rem !important;
        padding: 0 0.5rem !important;
    }

    /* 로그 컨테이너 */
    .log-card {
        padding: 0.75rem !important;
        background: var(--rz-base-background-color)!important;
        border: 1px solid #e1e4e8 !important;
    }

    .log-container {
        height: 150px;
        overflow-y: auto;
        background: #0d1117;
        border-radius: 4px;
        padding: 0.5rem;
        font-family: 'Consolas', 'Monaco', monospace;
        font-size: 0.7rem;
        line-height: 1.4;
    }

    .log-entry {
        margin-bottom: 0.15rem;
        white-space: pre-wrap;
        word-break: break-all;
    }

    .log-time {
        color: #8b949e;
    }

    .log-level {
        font-weight: 600;
        margin: 0 0.25rem;
    }

    .log-message {
        color: #c9d1d9;
    }

    .log-entry.ERROR .log-level {
        color: #f85149;
    }

    .log-entry.WARN .log-level {
        color: #f39c12;
    }

    .log-entry.INFO .log-level {
        color: #58a6ff;
    }

    .log-entry.SUCCESS .log-level {
        color: #56d364;
    }

    .log-entry.DEBUG .log-level {
        color: #8b949e;
    }

    /* 디버그 카드 */
    .debug-card {
        padding: 0.625rem !important;
        background: #fff8dc !important;
        border: 1px solid #f39c12 !important;
    }

    .compact-switch {
        transform: scale(0.8);
    }

    /* 스크롤바 */
    .log-container::-webkit-scrollbar {
        width: 5px;
    }

    .log-container::-webkit-scrollbar-track {
        background: #161b22;
        border-radius: 3px;
    }

    .log-container::-webkit-scrollbar-thumb {
        background: #30363d;
        border-radius: 3px;
    }

        .log-container::-webkit-scrollbar-thumb:hover {
            background: #484f58;
        }

    /* 애니메이션 */
    @@keyframes slideDown {
        from

    {
        opacity: 0;
        transform: translateY(-5px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }

    }

    /* 다크 테마 */
    :root[data-theme='dark'] .professional-panel {
        background: #0d1117 !important;
        border-color: #30363d !important;
    }

    :root[data-theme='dark'] .panel-header {
        background: #161b22;
        border-bottom-color: #30363d;
    }

        :root[data-theme='dark'] .panel-header:hover {
            background: #1f2937;
        }

    :root[data-theme='dark'] .info-card,
    :root[data-theme='dark'] .stats-card,
    :root[data-theme='dark'] .log-card {
        background: #161b22 !important;
        border-color: #30363d !important;
    }

    :root[data-theme='dark'] .stat-item {
        background: #0d1117;
        border-color: #30363d;
    }

    :root[data-theme='dark'] .debug-card {
        background: #1f2937 !important;
        border-color: #374151 !important;
    }
</style>