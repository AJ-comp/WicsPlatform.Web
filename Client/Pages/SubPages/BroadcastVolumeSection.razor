@using WicsPlatform.Server.Models.wics
@implements IDisposable

<RadzenCard class="mt-2 professional-panel">
    <!-- 패널 헤더 -->
    <div @onclick="TogglePanel" class="panel-header">
        <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" JustifyContent="JustifyContent.SpaceBetween">
            <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.375rem">
                <RadzenIcon Icon="volume_up" class="panel-icon primary" />
                <RadzenText TextStyle="TextStyle.Body1" class="panel-title">
                    @(Channel?.Name ?? "채널") - 볼륨 설정
                </RadzenText>
                @if (_hasUnsavedChanges)
                {
                    <RadzenBadge BadgeStyle="BadgeStyle.Warning" IsPill="true" Text="저장 필요" class="unsaved-badge" />
                }
            </RadzenStack>
            <RadzenIcon Icon="@(IsCollapsed ? "expand_more" : "expand_less")" class="expand-icon" />
        </RadzenStack>
    </div>

    <!-- 패널 내용 -->
    @if (!IsCollapsed)
    {
        <div class="panel-content">
            <RadzenStack Gap="0.75rem">
                <!-- 볼륨 컨트롤 그리드 -->
                <RadzenRow Gap="0.5rem">
                    <!-- 마이크 볼륨 -->
                    <RadzenColumn Size="12" SizeMD="6" SizeLG="3">
                        <RadzenCard class="volume-card">
                            <RadzenStack Gap="0.375rem">
                                <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" JustifyContent="JustifyContent.SpaceBetween">
                                    <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.25rem">
                                        <RadzenIcon Icon="mic" class="volume-icon info" />
                                        <RadzenText TextStyle="TextStyle.Caption" class="volume-title">마이크</RadzenText>
                                    </RadzenStack>
                                    <RadzenBadge BadgeStyle="BadgeStyle.Info" IsPill="true" Text="@($"{micVolume}%")" class="volume-badge" />
                                </RadzenStack>

                                <RadzenSlider @bind-Value="@micVolume"
                                              TValue="int"
                                              Min="0"
                                              Max="100"
                                              Step="1"
                                              Change="@((int value) => UpdateVolume("mic", value))"
                                              class="volume-slider" />

                                <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.SpaceBetween">
                                    <RadzenText TextStyle="TextStyle.Caption" class="volume-label">0%</RadzenText>
                                    <RadzenText TextStyle="TextStyle.Caption" class="volume-label">100%</RadzenText>
                                </RadzenStack>
                            </RadzenStack>
                        </RadzenCard>
                    </RadzenColumn>

                    <!-- TTS 볼륨 -->
                    <RadzenColumn Size="12" SizeMD="6" SizeLG="3">
                        <RadzenCard class="volume-card">
                            <RadzenStack Gap="0.375rem">
                                <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" JustifyContent="JustifyContent.SpaceBetween">
                                    <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.25rem">
                                        <RadzenIcon Icon="record_voice_over" class="volume-icon success" />
                                        <RadzenText TextStyle="TextStyle.Caption" class="volume-title">TTS</RadzenText>
                                    </RadzenStack>
                                    <RadzenBadge BadgeStyle="BadgeStyle.Success" IsPill="true" Text="@($"{ttsVolume}%")" class="volume-badge" />
                                </RadzenStack>

                                <RadzenSlider @bind-Value="@ttsVolume"
                                              TValue="int"
                                              Min="0"
                                              Max="100"
                                              Step="1"
                                              Change="@((int value) => UpdateVolume("tts", value))"
                                              class="volume-slider" />

                                <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.SpaceBetween">
                                    <RadzenText TextStyle="TextStyle.Caption" class="volume-label">0%</RadzenText>
                                    <RadzenText TextStyle="TextStyle.Caption" class="volume-label">100%</RadzenText>
                                </RadzenStack>
                            </RadzenStack>
                        </RadzenCard>
                    </RadzenColumn>

                    <!-- 미디어 볼륨 -->
                    <RadzenColumn Size="12" SizeMD="6" SizeLG="3">
                        <RadzenCard class="volume-card">
                            <RadzenStack Gap="0.375rem">
                                <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" JustifyContent="JustifyContent.SpaceBetween">
                                    <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.25rem">
                                        <RadzenIcon Icon="library_music" class="volume-icon warning" />
                                        <RadzenText TextStyle="TextStyle.Caption" class="volume-title">미디어</RadzenText>
                                    </RadzenStack>
                                    <RadzenBadge BadgeStyle="BadgeStyle.Warning" IsPill="true" Text="@($"{mediaVolume}%")" class="volume-badge" />
                                </RadzenStack>

                                <RadzenSlider @bind-Value="@mediaVolume"
                                              TValue="int"
                                              Min="0"
                                              Max="100"
                                              Step="1"
                                              Change="@((int value) => UpdateVolume("media", value))"
                                              class="volume-slider" />

                                <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.SpaceBetween">
                                    <RadzenText TextStyle="TextStyle.Caption" class="volume-label">0%</RadzenText>
                                    <RadzenText TextStyle="TextStyle.Caption" class="volume-label">100%</RadzenText>
                                </RadzenStack>
                            </RadzenStack>
                        </RadzenCard>
                    </RadzenColumn>

                    <!-- 전체 볼륨 -->
                    <RadzenColumn Size="12" SizeMD="6" SizeLG="3">
                        <RadzenCard class="volume-card master">
                            <RadzenStack Gap="0.375rem">
                                <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" JustifyContent="JustifyContent.SpaceBetween">
                                    <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.25rem">
                                        <RadzenIcon Icon="volume_up" class="volume-icon primary" />
                                        <RadzenText TextStyle="TextStyle.Caption" class="volume-title">마스터</RadzenText>
                                    </RadzenStack>
                                    <RadzenBadge BadgeStyle="BadgeStyle.Primary" IsPill="true" Text="@($"{globalVolume}%")" class="volume-badge" />
                                </RadzenStack>

                                <RadzenSlider @bind-Value="@globalVolume"
                                              TValue="int"
                                              Min="0"
                                              Max="100"
                                              Step="1"
                                              Change="@((int value) => UpdateVolume("global", value))"
                                              class="volume-slider master" />

                                <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.SpaceBetween">
                                    <RadzenText TextStyle="TextStyle.Caption" class="volume-label">0%</RadzenText>
                                    <RadzenText TextStyle="TextStyle.Caption" class="volume-label">100%</RadzenText>
                                </RadzenStack>
                            </RadzenStack>
                        </RadzenCard>
                    </RadzenColumn>
                </RadzenRow>

                <!-- 미리 설정된 프리셋 -->
                <RadzenCard class="preset-card">
                    <RadzenStack Gap="0.5rem">
                        <RadzenText TextStyle="TextStyle.Caption" class="preset-title">빠른 프리셋</RadzenText>
                        <RadzenStack Orientation="Orientation.Horizontal" Gap="0.375rem">
                            <RadzenButton Text="음악 모드"
                                          Icon="music_note"
                                          ButtonStyle="ButtonStyle.Light"
                                          Size="ButtonSize.Small"
                                          class="preset-button"
                                          Click="@(() => ApplyPreset("music"))" />
                            <RadzenButton Text="음성 모드"
                                          Icon="mic"
                                          ButtonStyle="ButtonStyle.Light"
                                          Size="ButtonSize.Small"
                                          class="preset-button"
                                          Click="@(() => ApplyPreset("voice"))" />
                            <RadzenButton Text="균형 모드"
                                          Icon="equalizer"
                                          ButtonStyle="ButtonStyle.Light"
                                          Size="ButtonSize.Small"
                                          class="preset-button"
                                          Click="@(() => ApplyPreset("balanced"))" />
                            <RadzenButton Text="조용히"
                                          Icon="volume_down"
                                          ButtonStyle="ButtonStyle.Light"
                                          Size="ButtonSize.Small"
                                          class="preset-button"
                                          Click="@(() => ApplyPreset("quiet"))" />
                        </RadzenStack>
                    </RadzenStack>
                </RadzenCard>

                <!-- 액션 버튼 -->
                <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.End" Gap="0.5rem">
                    <RadzenButton Text="초기화"
                                  Icon="refresh"
                                  ButtonStyle="ButtonStyle.Light"
                                  Size="ButtonSize.Small"
                                  class="action-button"
                                  Click="@ResetVolumes" />
                    <RadzenButton Text="설정 저장"
                                  Icon="save"
                                  ButtonStyle="@(_hasUnsavedChanges ? ButtonStyle.Warning : ButtonStyle.Primary)"
                                  Size="ButtonSize.Small"
                                  class="action-button primary"
                                  Click="@SaveVolumes"
                                  IsBusy="@isSavingVolumes" />
                </RadzenStack>

                @if (_hasUnsavedChanges)
                {
                    <RadzenAlert AlertStyle="AlertStyle.Warning"
                                 Variant="Variant.Flat"
                                 Size="AlertSize.Small"
                                 class="unsaved-alert">
                        <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.375rem">
                            <RadzenIcon Icon="warning" class="alert-icon" />
                            <RadzenText TextStyle="TextStyle.Caption" class="alert-text">
                                볼륨 설정이 변경되었습니다. 변경사항을 저장하려면 '설정 저장' 버튼을 클릭하세요.
                            </RadzenText>
                        </RadzenStack>
                    </RadzenAlert>
                }
            </RadzenStack>
        </div>
    }
</RadzenCard>

<style>
    /* 전문적인 패널 디자인 */
    .professional-panel {
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05) !important;
        border: 1px solid #dde2e6 !important;
        border-radius: 6px !important;
        background: white !important;
        overflow: hidden;
    }

    .panel-header {
        background: #fafbfc;
        padding: 0.625rem 0.875rem;
        cursor: pointer;
        transition: all 0.2s ease;
        border-bottom: 1px solid #e1e4e8;
        user-select: none;
    }

        .panel-header:hover {
            background: #f5f6f8;
        }

    .panel-icon.primary {
        font-size: 1rem !important;
        color: #3498db !important;
    }

    .panel-title {
        font-size: 0.875rem !important;
        font-weight: 600 !important;
        color: #2c3e50 !important;
        margin: 0 !important;
    }

    .unsaved-badge {
        font-size: 0.6rem !important;
        padding: 2px 5px !important;
    }

    .expand-icon {
        font-size: 1rem !important;
        color: #6c757d !important;
        transition: transform 0.2s ease;
    }

    .panel-content {
        padding: 0.875rem;
        animation: slideDown 0.2s ease-out;
    }

    /* 볼륨 카드 */
    .volume-card {
        padding: 0.625rem !important;
        background: #fafbfc !important;
        border: 1px solid #e1e4e8 !important;
        height: 100%;
        transition: all 0.2s ease;
    }

        .volume-card:hover {
            background: white !important;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05) !important;
        }

        .volume-card.master {
            background: white !important;
            border-color: #3498db !important;
        }

    .volume-icon {
        font-size: 0.875rem !important;
    }

        .volume-icon.info {
            color: #3498db !important;
        }

        .volume-icon.success {
            color: #27ae60 !important;
        }

        .volume-icon.warning {
            color: #f39c12 !important;
        }

        .volume-icon.primary {
            color: #3498db !important;
        }

    .volume-title {
        font-size: 0.7rem !important;
        font-weight: 600 !important;
        color: #2c3e50 !important;
        margin: 0 !important;
    }

    .volume-badge {
        font-size: 0.65rem !important;
        padding: 2px 6px !important;
        font-weight: 600 !important;
    }

    /* 볼륨 슬라이더 */
    .volume-slider {
        margin: 0.375rem 0 !important;
    }

        .volume-slider .rz-slider-horizontal .rz-slider-track {
            height: 5px !important;
            background-color: #e1e4e8 !important;
        }

        .volume-slider .rz-slider-horizontal .rz-slider-range {
            height: 5px !important;
            background-color: #3498db !important;
        }

        .volume-slider.master .rz-slider-horizontal .rz-slider-range {
            background-color: #2c3e50 !important;
        }

        .volume-slider .rz-slider-handle {
            width: 14px !important;
            height: 14px !important;
            top: -5px !important;
            background-color: white !important;
            border: 2px solid #3498db !important;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2) !important;
        }

        .volume-slider.master .rz-slider-handle {
            border-color: #2c3e50 !important;
        }

    .volume-label {
        font-size: 0.6rem !important;
        color: #6c757d !important;
        margin: 0 !important;
    }

    /* 프리셋 카드 */
    .preset-card {
        padding: 0.625rem !important;
        background: #f8f9fa !important;
        border: 1px solid #e1e4e8 !important;
    }

    .preset-title {
        font-size: 0.7rem !important;
        font-weight: 600 !important;
        color: #2c3e50 !important;
        margin: 0 !important;
    }

    .preset-button {
        font-size: 0.65rem !important;
        padding: 0.25rem 0.5rem !important;
        height: 26px !important;
    }

        .preset-button .rz-button-icon {
            font-size: 0.75rem !important;
        }

    /* 액션 버튼 */
    .action-button {
        font-size: 0.7rem !important;
        padding: 0.25rem 0.75rem !important;
        height: 28px !important;
    }

        .action-button.primary {
            background: #3498db !important;
            border-color: #3498db !important;
            color: white !important;
            font-weight: 500 !important;
        }

            .action-button.primary:hover {
                background: #2980b9 !important;
                border-color: #2980b9 !important;
            }

    /* 경고 알림 */
    .unsaved-alert {
        padding: 0.5rem 0.75rem !important;
        background-color: #fff3cd !important;
        border: 1px solid #ffc107 !important;
    }

    .alert-icon {
        font-size: 0.875rem !important;
        color: #f39c12 !important;
    }

    .alert-text {
        font-size: 0.7rem !important;
        color: #856404 !important;
        margin: 0 !important;
    }

    /* 애니메이션 */
    @@keyframes slideDown {
        from

    {
        opacity: 0;
        transform: translateY(-5px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }

    }

    /* 다크 테마 */
    :root[data-theme='dark'] .professional-panel {
        background: #0d1117 !important;
        border-color: #30363d !important;
    }

    :root[data-theme='dark'] .panel-header {
        background: #161b22;
        border-bottom-color: #30363d;
    }

        :root[data-theme='dark'] .panel-header:hover {
            background: #1f2937;
        }

    :root[data-theme='dark'] .volume-card {
        background: #161b22 !important;
        border-color: #30363d !important;
    }

        :root[data-theme='dark'] .volume-card:hover {
            background: #1f2937 !important;
        }

        :root[data-theme='dark'] .volume-card.master {
            background: #1f2937 !important;
            border-color: #3498db !important;
        }

    :root[data-theme='dark'] .preset-card {
        background: #161b22 !important;
        border-color: #30363d !important;
    }

    :root[data-theme='dark'] .volume-slider .rz-slider-horizontal .rz-slider-track {
        background-color: #30363d !important;
    }

    :root[data-theme='dark'] .unsaved-alert {
        background-color: #1f2937 !important;
        border-color: #374151 !important;
    }

    :root[data-theme='dark'] .alert-text {
        color: #fbbf24 !important;
    }
</style>