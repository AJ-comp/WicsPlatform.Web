@page "/manage-tts"
@attribute [Authorize]

<PageTitle>TTS 관리</PageTitle>

<RadzenStack>
    <!-- 페이지 헤더 -->
    <RadzenRow AlignItems="AlignItems.Center" Class="page-header mb-3">
        <RadzenColumn Size="12">
            <RadzenText Text="TTS 관리" TextStyle="TextStyle.H5" TagName="TagName.H1" class="page-title" />
            <RadzenText Text="텍스트 음성 변환 콘텐츠를 생성하고 관리합니다" TextStyle="TextStyle.Caption" class="page-subtitle" />
        </RadzenColumn>
    </RadzenRow>

    <!-- 액션 바 -->
    <RadzenRow Class="mb-2">
        <RadzenColumn Size="12">
            <RadzenCard class="action-bar">
                <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" JustifyContent="JustifyContent.SpaceBetween">
                    <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.5rem">
                        @if (selectedTts.Any())
                        {
                            <RadzenText TextStyle="TextStyle.Caption" class="selection-info">
                                <RadzenIcon Icon="check_circle" class="selection-icon" />
                                @(selectedTts.Count())개 선택됨
                            </RadzenText>
                            <RadzenButton Text="채널에 추가"
                                          Icon="library_add"
                                          ButtonStyle="ButtonStyle.Light"
                                          Size="ButtonSize.Small"
                                          Click="@OpenAddTtsToChannelDialog"
                                          class="action-button" />
                            <RadzenButton Text="선택 해제"
                                          Icon="clear"
                                          ButtonStyle="ButtonStyle.Light"
                                          Variant="Variant.Flat"
                                          Size="ButtonSize.Small"
                                          Click="@ClearSelection"
                                          class="clear-button" />
                        }
                    </RadzenStack>
                    <RadzenButton Text="새 TTS 추가"
                                  Icon="add"
                                  ButtonStyle="ButtonStyle.Primary"
                                  Size="ButtonSize.Small"
                                  Click="@OpenAddTtsDialog"
                                  class="primary-button" />
                </RadzenStack>
            </RadzenCard>
        </RadzenColumn>
    </RadzenRow>

    <!-- 검색 필터 -->
    <RadzenRow Class="mb-3">
        <RadzenColumn Size="12">
            <RadzenCard class="filter-card">
                <RadzenStack Gap="0.5rem">
                    <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.5rem" class="mb-2">
                        <RadzenIcon Icon="filter_list" class="filter-icon" />
                        <RadzenText TextStyle="TextStyle.Caption" class="filter-title">검색 필터</RadzenText>
                    </RadzenStack>
                    <RadzenRow Gap="0.35rem">
                        <RadzenColumn Size="12" SizeMD="4">
                            <RadzenTextBox @bind-Value="@searchFilter"
                                           Change="@ApplyFilters"
                                           Placeholder="TTS 제목 또는 내용 검색..."
                                           class="filter-input" />
                        </RadzenColumn>
                        <RadzenColumn Size="12" SizeMD="4">
                            <RadzenDatePicker @bind-Value="@dateFilter"
                                              DateFormat="yyyy-MM-dd"
                                              Change="@ApplyFilters"
                                              Placeholder="생성일 선택"
                                              class="filter-input" />
                        </RadzenColumn>
                        <RadzenColumn Size="12" SizeMD="4" Class="text-end">
                            <RadzenButton Text="필터 초기화"
                                          Click="@ResetFilters"
                                          ButtonStyle="ButtonStyle.Light"
                                          Variant="Variant.Flat"
                                          Size="ButtonSize.Small"
                                          class="reset-button" />
                        </RadzenColumn>
                    </RadzenRow>
                </RadzenStack>
            </RadzenCard>
        </RadzenColumn>
    </RadzenRow>

    <!-- TTS 목록 -->
    <RadzenRow>
        <RadzenColumn Size="12">
            <RadzenCard class="content-panel">
                @if (isLoading)
                {
                    <div class="loading-container">
                        <RadzenProgressBar Value="100" ShowValue="false" Mode="ProgressBarMode.Indeterminate" class="slim-progress" />
                        <RadzenText Text="TTS 목록을 불러오는 중입니다..." TextStyle="TextStyle.Caption" class="loading-text" />
                    </div>
                }
                else if (!ttsList?.Any() == true)
                {
                    <div class="empty-state">
                        <RadzenIcon Icon="mic_off" class="empty-icon" />
                        <RadzenText Text="등록된 TTS가 없습니다" TextStyle="TextStyle.Caption" class="empty-text" />
                        <RadzenText Text="새 TTS 추가 버튼을 클릭하여 TTS를 생성하세요" TextStyle="TextStyle.Caption" class="empty-subtext" />
                    </div>
                }
                else
                {
                    <div class="table-container">
                        <table class="professional-table">
                            <thead>
                                <tr>
                                    <th class="checkbox-column">
                                        <RadzenCheckBox TValue="bool"
                                                        TriState="false"
                                                        @bind-Value="@selectAllChecked"
                                                        Change="@SelectAllTtsChanged"
                                                        class="table-checkbox" />
                                    </th>
                                    <th class="title-column">제목</th>
                                    <th class="content-column">내용</th>
                                    <th class="date-column">생성일</th>
                                    <th class="play-column">재생</th>
                                    <th class="action-column">작업</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var tts in filteredTtsList ?? ttsList)
                                {
                                    <tr class="@(IsTtsSelected(tts) ? "selected" : "")" @onclick="@(() => ToggleTtsSelection(tts))">
                                        <td class="checkbox-column" @onclick:stopPropagation="true">
                                            <RadzenCheckBox TValue="bool"
                                                            Value="@IsTtsSelected(tts)"
                                                            Change="@(args => TtsSelectionChanged(args, tts))"
                                                            class="table-checkbox" />
                                        </td>
                                        <td class="title-column">
                                            <div class="title-cell">
                                                <RadzenIcon Icon="record_voice_over" class="title-icon" />
                                                <span class="title-text">@tts.Name</span>
                                            </div>
                                        </td>
                                        <td class="content-column">
                                            <div class="content-cell" title="@tts.Content">
                                                @tts.Content
                                            </div>
                                        </td>
                                        <td class="date-column">
                                            <span class="date-text">@tts.CreatedAt.ToString("yyyy-MM-dd")</span>
                                            <span class="time-text">@tts.CreatedAt.ToString("HH:mm")</span>
                                        </td>
                                        <td class="play-column" @onclick:stopPropagation="true">
                                            <RadzenButton Icon="play_arrow"
                                                          ButtonStyle="ButtonStyle.Success"
                                                          Variant="Variant.Flat"
                                                          Size="ButtonSize.Small"
                                                          Click="@(() => PlayTts(tts))"
                                                          class="play-button" />
                                        </td>
                                        <td class="action-column" @onclick:stopPropagation="true">
                                            <RadzenButton Icon="edit"
                                                          ButtonStyle="ButtonStyle.Light"
                                                          Variant="Variant.Flat"
                                                          Size="ButtonSize.Small"
                                                          Click="@(() => OpenEditTtsDialog(tts))"
                                                          class="table-action-button" />
                                            <RadzenButton Icon="delete"
                                                          ButtonStyle="ButtonStyle.Light"
                                                          Variant="Variant.Flat"
                                                          Size="ButtonSize.Small"
                                                          Click="@(() => OpenDeleteTtsDialog(tts))"
                                                          class="table-action-button delete" />
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>

                    @if (ttsList?.Count() > 10)
                    {
                        <div class="pagination-container">
                            <RadzenPager Count="@((ttsList?.Count() ?? 0 + 9) / 10)"
                                         PageSize="10"
                                         PageNumbersCount="5"
                                         PageChanged="@(args => OnPageChanged(args))"
                                         HorizontalAlign="HorizontalAlign.Right"
                                         ShowPagingSummary="true"
                                         PagingSummaryFormat="@GetPagingSummaryFormat()"
                                         class="compact-pager" />
                        </div>
                    }
                }
            </RadzenCard>
        </RadzenColumn>
    </RadzenRow>
</RadzenStack>

<style>
    /* 전문적이고 고급스러운 디자인 시스템 */
    :root {
        --professional-primary: #2c3e50;
        --professional-secondary: #34495e;
        --professional-accent: #3498db;
        --professional-success: #27ae60;
        --professional-danger: #e74c3c;
        --professional-warning: #f39c12;
        --professional-border: #dde2e6;
        --professional-hover: #ecf0f1;
        --professional-selected: #e8f4fd;
    }

    /* 페이지 헤더 */
    .page-header {
        border-bottom: 1px solid var(--professional-border);
        padding-bottom: 0.75rem;
        margin-bottom: 1rem;
    }

    .page-title {
        font-size: 1.25rem !important;
        font-weight: 600 !important;
        color: var(--professional-primary) !important;
        margin: 0 !important;
        letter-spacing: -0.5px;
    }

    .page-subtitle {
        font-size: 0.75rem !important;
        color: #6c757d !important;
        margin-top: 0.25rem !important;
        font-weight: 400;
    }

    /* 액션 바 */
    .action-bar {
        background: #fafbfc !important;
        border: 1px solid #e1e4e8 !important;
        padding: 0.5rem 0.75rem !important;
        border-radius: 4px !important;
    }

    .selection-info {
        font-size: 0.75rem !important;
        color: var(--professional-primary) !important;
        display: flex;
        align-items: center;
        gap: 0.25rem;
        font-weight: 500;
    }

    .selection-icon {
        font-size: 0.875rem !important;
        color: var(--professional-accent) !important;
    }

    .action-button, .clear-button {
        font-size: 0.75rem !important;
        padding: 0.25rem 0.5rem !important;
        height: 28px !important;
    }

    .primary-button {
        font-size: 0.75rem !important;
        padding: 0.25rem 0.75rem !important;
        height: 28px !important;
        background: var(--professional-accent) !important;
        border-color: var(--professional-accent) !important;
        font-weight: 500 !important;
    }

        .primary-button:hover {
            background: #2980b9 !important;
            border-color: #2980b9 !important;
        }

    /* 필터 카드 */
    .filter-card {
        background: #fafbfc !important;
        border: 1px solid #e1e4e8 !important;
        padding: 0.65rem !important;
        border-radius: 4px !important;
    }

    .filter-icon {
        font-size: 0.875rem !important;
        color: #6c757d !important;
    }

    .filter-title {
        font-size: 0.75rem !important;
        font-weight: 600 !important;
        color: var(--professional-secondary) !important;
        margin: 0 !important;
    }

    .filter-input {
        font-size: 0.75rem !important;
        height: 32px !important;
        border-color: #d0d7de !important;
        width: 100%;
    }

        .filter-input input {
            font-size: 0.75rem !important;
            padding: 0.35rem 0.5rem !important;
        }

    .reset-button {
        font-size: 0.7rem !important;
        padding: 0.25rem 0.5rem !important;
        height: 28px !important;
    }

    /* 콘텐츠 패널 */
    .content-panel {
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05) !important;
        border: 1px solid var(--professional-border) !important;
        border-radius: 6px !important;
        background: white !important;
        min-height: 400px;
    }

    /* 테이블 스타일 */
    .table-container {
        overflow-x: auto;
    }

    .professional-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        font-size: 0.75rem;
    }

        .professional-table thead tr {
            background: #f6f8fa;
            border-bottom: 2px solid #e1e4e8;
        }

        .professional-table th {
            padding: 0.5rem 0.75rem;
            text-align: left;
            font-weight: 600;
            color: var(--professional-primary);
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 2px solid #e1e4e8;
        }

        .professional-table tbody tr {
            border-bottom: 1px solid #f0f0f0;
            transition: all 0.15s ease;
            cursor: pointer;
        }

            .professional-table tbody tr:hover {
                background: var(--professional-hover);
            }

            .professional-table tbody tr.selected {
                background: var(--professional-selected);
            }

        .professional-table td {
            padding: 0.65rem 0.75rem;
            color: var(--professional-secondary);
            vertical-align: middle;
        }

    /* 컬럼 너비 */
    .checkbox-column {
        width: 40px;
        text-align: center !important;
    }

    .title-column {
        width: 200px;
        min-width: 150px;
    }

    .content-column {
        width: auto;
        min-width: 300px;
    }

    .date-column {
        width: 120px;
    }

    .play-column {
        width: 60px;
        text-align: center !important;
    }

    .action-column {
        width: 100px;
        text-align: center !important;
    }

    /* 테이블 셀 스타일 */
    .table-checkbox {
        transform: scale(0.85);
    }

    .title-cell {
        display: flex;
        align-items: center;
        gap: 0.35rem;
    }

    .title-icon {
        font-size: 0.875rem !important;
        color: var(--professional-accent) !important;
    }

    .title-text {
        font-weight: 500;
        color: var(--professional-primary);
    }

    .content-cell {
        max-width: 400px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        font-size: 0.7rem;
        color: #6c757d;
    }

    .date-column td {
        display: flex;
        flex-direction: column;
        gap: 0.1rem;
    }

    .date-text {
        font-size: 0.7rem;
        color: var(--professional-secondary);
    }

    .time-text {
        font-size: 0.65rem;
        color: #6c757d;
    }

    /* 버튼 스타일 */
    .play-button {
        min-width: 28px !important;
        height: 28px !important;
        padding: 4px !important;
    }

        .play-button:hover {
            background: var(--professional-success) !important;
            color: white !important;
        }

    .table-action-button {
        min-width: 24px !important;
        height: 24px !important;
        padding: 4px !important;
        opacity: 0.7;
        transition: all 0.15s ease;
    }

        .table-action-button:hover {
            opacity: 1;
            background: var(--professional-hover) !important;
        }

        .table-action-button.delete:hover {
            color: var(--professional-danger) !important;
            background: #fee !important;
        }

    /* 페이지네이션 */
    .pagination-container {
        padding: 0.75rem;
        border-top: 1px solid #e1e4e8;
        background: #fafbfc;
    }

    .compact-pager {
        font-size: 0.75rem !important;
    }

        .compact-pager .rz-paginator-element {
            min-width: 28px !important;
            height: 28px !important;
            font-size: 0.7rem !important;
        }

    /* 로딩 상태 */
    .loading-container {
        text-align: center;
        padding: 3rem 0;
    }

    .slim-progress {
        width: 120px !important;
        height: 4px !important;
        margin: 0 auto !important;
    }

    .loading-text {
        margin-top: 0.75rem !important;
        font-size: 0.75rem !important;
        color: #6c757d !important;
    }

    /* 빈 상태 */
    .empty-state {
        text-align: center;
        padding: 3rem 0;
    }

    .empty-icon {
        width: 32px !important;
        height: 32px !important;
        font-size: 32px !important;
        color: #d0d7de !important;
        margin-bottom: 0.75rem;
    }

    .empty-text {
        font-size: 0.8rem !important;
        color: var(--professional-secondary) !important;
        margin: 0.5rem 0 0.25rem 0 !important;
    }

    .empty-subtext {
        font-size: 0.7rem !important;
        color: #6c757d !important;
        margin: 0 !important;
    }

    /* 스크롤바 스타일링 */
    .table-container::-webkit-scrollbar {
        height: 6px;
    }

    .table-container::-webkit-scrollbar-track {
        background: #f0f0f0;
        border-radius: 3px;
    }

    .table-container::-webkit-scrollbar-thumb {
        background: #c0c0c0;
        border-radius: 3px;
    }

        .table-container::-webkit-scrollbar-thumb:hover {
            background: #a0a0a0;
        }

    /* 다크 테마 지원 */
    :root[data-theme='dark'] .page-title {
        color: #e1e4e8 !important;
    }

    :root[data-theme='dark'] .page-subtitle {
        color: #8b949e !important;
    }

    :root[data-theme='dark'] .content-panel {
        background: #0d1117 !important;
        border-color: #30363d !important;
    }

    :root[data-theme='dark'] .action-bar,
    :root[data-theme='dark'] .filter-card {
        background: #161b22 !important;
        border-color: #30363d !important;
    }

    :root[data-theme='dark'] .professional-table thead tr {
        background: #161b22 !important;
    }

    :root[data-theme='dark'] .professional-table th {
        color: #c9d1d9 !important;
        border-bottom-color: #30363d !important;
    }

    :root[data-theme='dark'] .professional-table tbody tr {
        border-bottom-color: #21262d !important;
    }

        :root[data-theme='dark'] .professional-table tbody tr:hover {
            background: #161b22 !important;
        }

        :root[data-theme='dark'] .professional-table tbody tr.selected {
            background: #1f2937 !important;
        }

    :root[data-theme='dark'] .professional-table td {
        color: #8b949e !important;
    }

    :root[data-theme='dark'] .title-text {
        color: #c9d1d9 !important;
    }

    :root[data-theme='dark'] .pagination-container {
        background: #161b22 !important;
        border-top-color: #30363d !important;
    }
</style>