@attribute [Authorize]

<div class="add-media-to-playlist-dialog">
    <div class="dialog-header">
        <RadzenIcon Icon="playlist_add" Style="font-size: 32px; margin-right: 12px;" />
        <RadzenText TextStyle="TextStyle.H5" class="mb-0">플레이리스트에 미디어 추가</RadzenText>
    </div>

    <div class="dialog-description">
        <RadzenText TextStyle="TextStyle.Body2">
            선택한 미디어 파일을 플레이리스트에 추가합니다. 추가할 플레이리스트를 선택해주세요.
        </RadzenText>
    </div>

    <RadzenAlert Shade="Shade.Lighter" Variant="Variant.Flat" Size="AlertSize.Small"
                 AlertStyle="AlertStyle.Danger" Visible="@errorVisible">
        <RadzenIcon Icon="error_outline" class="me-2" />
        @error
    </RadzenAlert>

    <div class="selected-count mb-4">
        <RadzenBadge BadgeStyle="BadgeStyle.Info" IsPill="true" Text="@($"{selectedMedia.Count()} 개 미디어 선택됨")" />
    </div>

    @if (isLoading)
    {
        <div class="text-center py-5">
            <RadzenProgressBar Value="100" ShowValue="false" Mode="ProgressBarMode.Indeterminate" Style="width: 50%; height: 8px; margin: 0 auto;" />
            <RadzenText TextStyle="TextStyle.Body1" class="mt-3 mb-0">플레이리스트 목록을 불러오는 중입니다...</RadzenText>
        </div>
    }
    else if (playlists == null || !playlists.Any())
    {
        <div class="text-center py-5">
            <RadzenIcon Icon="playlist_remove" Style="font-size: 48px; opacity: 0.5;" class="mb-3" />
            <RadzenText TextStyle="TextStyle.H5" class="mb-2">플레이리스트가 없습니다</RadzenText>
            <RadzenText TextStyle="TextStyle.Body2" class="mb-3">먼저 플레이리스트를 생성해주세요.</RadzenText>
        </div>
    }
    else
    {
        <div class="form-section">
            <RadzenRow style="margin-bottom: 1.5rem">
                <RadzenColumn SizeMD="3">
                    <RadzenLabel Text="플레이리스트" Component="PlaylistId" style="width: 100%" />
                </RadzenColumn>
                <RadzenColumn SizeMD="9">
                    <div class="custom-input-container">
                        <RadzenIcon Icon="playlist_play" />
                        <RadzenDropDown @bind-Value="selectedPlaylistId"
                                        Data="@playlists"
                                        TextProperty="Name"
                                        ValueProperty="Id"
                                        AllowClear="false"
                                        AllowFiltering="true"
                                        FilterCaseSensitivity="FilterCaseSensitivity.CaseInsensitive"
                                        Placeholder="플레이리스트 선택..."
                                        style="display: block; width: 100%; padding-left: 35px;"
                                        Name="PlaylistId" />
                    </div>
                </RadzenColumn>
            </RadzenRow>
        </div>
    }

    <div class="form-actions">
        <RadzenButton ButtonStyle="ButtonStyle.Light" Text="취소" Click="@CancelClick" Variant="Variant.Flat" class="me-2" Disabled="@isProcessing" />
        @if (isProcessing)
        {
            <RadzenButton ButtonType="ButtonType.Button" Text="처리 중..." Icon="sync" IconSpin="true"
                          Disabled="true" Variant="Variant.Flat" ButtonStyle="ButtonStyle.Primary" />
        }
        else
        {
            <RadzenButton ButtonType="ButtonType.Button" Icon="playlist_add" Text="추가"
                          Variant="Variant.Flat" ButtonStyle="ButtonStyle.Primary"
                          Click="@AddToPlaylist"
                          Disabled="@(playlists == null || !playlists.Any() || selectedPlaylistId == 0 || isLoading || selectedMedia == null || !selectedMedia.Any())" />
        }
    </div>
</div>

<style>
    .add-media-to-playlist-dialog {
        padding: 0;
    }

    .dialog-header {
        display: flex;
        align-items: center;
        margin-bottom: 16px;
    }

    .dialog-description {
        margin-bottom: 24px;
        padding-bottom: 16px;
        border-bottom: 1px solid var(--rz-border-light);
    }

    .form-section {
        margin-bottom: 20px;
    }

    .custom-input-container {
        position: relative;
    }

        .custom-input-container .rz-icon {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            z-index: 1;
        }

    .form-actions {
        display: flex;
        justify-content: flex-end;
        padding-top: 16px;
        margin-top: 16px;
        border-top: 1px solid var(--rz-border-light);
    }

    .selected-count {
        margin-top: 10px;
    }
</style>
