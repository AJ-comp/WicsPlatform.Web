@attribute [Authorize]
@using Microsoft.AspNetCore.Components.Forms

<RadzenStack Gap="1rem" class="media-dialog-modern">
    <!-- 헤더 카드 -->
    <RadzenCard Variant="Variant.Outlined" class="header-card">
        <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.75rem">
            <div class="icon-wrapper">
                <RadzenIcon Icon="audio_file" Style="font-size: 1.5rem; color: var(--rz-primary);" />
            </div>
            <RadzenStack Gap="0.25rem">
                <RadzenText TextStyle="TextStyle.H6" class="mb-0" Style="color: var(--rz-text-color); font-weight: 600;">
                    미디어 파일 추가
                </RadzenText>
                <RadzenText TextStyle="TextStyle.Caption" class="mb-0" Style="color: var(--rz-text-secondary-color); font-size: 0.75rem;">
                    음원 파일을 업로드하여 미디어 라이브러리에 추가합니다
                </RadzenText>
            </RadzenStack>
        </RadzenStack>
    </RadzenCard>

    <!-- 파일 업로드 영역 -->
    <RadzenCard class="upload-zone-card">
        <InputFile OnChange="@OnInputFileChange"
                   multiple
                   id="mediaFileInput"
                   accept="audio/*"
                   @key="@fileInputKey"
                   style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer; z-index: 1;" />

        <div @ondragenter="@OnDragEnter" @ondragleave="@OnDragLeave" @ondragover:preventDefault @ondrop="@OnDrop"
             class="upload-area">
            <!-- Corner Decorations -->
            <div class="upload-corner corner-tl"></div>
            <div class="upload-corner corner-tr"></div>
            <div class="upload-corner corner-bl"></div>
            <div class="upload-corner corner-br"></div>

            <RadzenStack Gap="0.5rem" Style="text-align: center; padding: 1.5rem;">
                <RadzenIcon Icon="cloud_upload" Style="font-size: 2.5rem; color: var(--rz-primary); margin-bottom: 0.5rem;" class="upload-icon-animated" />
                <RadzenText TextStyle="TextStyle.Body2" Style="font-weight: 500;">
                    파일을 끌어다 놓거나 클릭하여 업로드하세요
                </RadzenText>
                <RadzenText TextStyle="TextStyle.Caption" Style="opacity: 0.7;">
                    지원 형식: MP3, WAV, OGG, FLAC (최대 100MB)
                </RadzenText>
                <RadzenButton Click="@(() => ClickFileInput())" Text="파일 선택"
                              Icon="file_upload" ButtonStyle="ButtonStyle.Primary" Size="ButtonSize.Small" 
                              Style="margin-top: 0.5rem;" />
            </RadzenStack>
        </div>

        @if (isDraggingOver)
        {
            <div class="drag-overlay">
                <RadzenStack Gap="0.5rem" Style="align-items: center;">
                    <RadzenIcon Icon="file_download" Style="font-size: 3rem; color: white;" class="bounce-animation" />
                    <RadzenText TextStyle="TextStyle.H6" Style="color: white; font-weight: 500;">
                        파일을 여기에 놓으세요
                    </RadzenText>
                </RadzenStack>
            </div>
        }

        @if (isUploading)
        {
            <div class="upload-progress-overlay">
                <RadzenStack Gap="1rem" Style="align-items: center;">
                    <RadzenText TextStyle="TextStyle.Body2" Style="color: white;">
                        파일 업로드 중...
                    </RadzenText>
                    <RadzenProgressBar Value="@uploadProgress" ShowValue="true" ProgressBarStyle="ProgressBarStyle.Light"
                                       Style="width: 200px; height: 6px;" Max="100" />
                    <RadzenText TextStyle="TextStyle.Caption" Style="color: rgba(255, 255, 255, 0.8);">
                        @uploadingFileName (@uploadProgress%)
                    </RadzenText>
                </RadzenStack>
            </div>
        }
    </RadzenCard>

    <!-- 업로드된 파일 목록 -->
    @if (uploadedFiles.Any())
    {
        <RadzenCard Variant="Variant.Outlined" Style="padding: 1rem;">
            <RadzenStack Gap="0.75rem">
                <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.5rem">
                    <RadzenIcon Icon="check_circle" Style="font-size: 1rem; color: var(--rz-success);" />
                    <RadzenText TextStyle="TextStyle.Subtitle2" class="mb-0" Style="font-weight: 600;">
                        업로드 완료 (@uploadedFiles.Count 개)
                    </RadzenText>
                </RadzenStack>
                <RadzenStack Gap="0.5rem" class="uploaded-files-list">
                    @foreach (var file in uploadedFiles)
                    {
                        <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.SpaceBetween" AlignItems="AlignItems.Center" 
                                   Style="padding: 0.5rem; border: 1px solid var(--rz-border-color); border-radius: var(--rz-border-radius); background: var(--rz-base-background-color);">
                            <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.5rem">
                                <RadzenIcon Icon="audiotrack" Style="font-size: 1rem; color: var(--rz-success);" />
                                <RadzenText TextStyle="TextStyle.Body2" class="mb-0">@file</RadzenText>
                            </RadzenStack>
                            <RadzenIcon Icon="check_circle" Style="font-size: 0.875rem; color: var(--rz-success);" />
                        </RadzenStack>
                    }
                </RadzenStack>
            </RadzenStack>
        </RadzenCard>
    }

    <!-- 안내 카드 -->
    <RadzenCard Variant="Variant.Filled" Style="background-color: var(--rz-info-lighter); border: 1px solid var(--rz-info-light); padding: 1rem;">
        <RadzenStack Gap="0.75rem">
            <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.5rem">
                <RadzenIcon Icon="info" Style="font-size: 1rem; color: var(--rz-info);" />
                <RadzenText TextStyle="TextStyle.Subtitle2" class="mb-0" Style="color: var(--rz-info); font-weight: 600; font-size: 0.8rem;">
                    업로드 안내
                </RadzenText>
            </RadzenStack>
            <RadzenStack Gap="0.5rem" Style="padding-left: 1.5rem;">
                <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Start" Gap="0.5rem">
                    <RadzenIcon Icon="check_circle" Style="font-size: 0.75rem; color: var(--rz-info); margin-top: 0.125rem;" />
                    <RadzenText TextStyle="TextStyle.Caption" class="mb-0" Style="color: var(--rz-text-color); font-size: 0.75rem;">
                        여러 파일을 한 번에 업로드할 수 있습니다
                    </RadzenText>
                </RadzenStack>
                <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Start" Gap="0.5rem">
                    <RadzenIcon Icon="check_circle" Style="font-size: 0.75rem; color: var(--rz-info); margin-top: 0.125rem;" />
                    <RadzenText TextStyle="TextStyle.Caption" class="mb-0" Style="color: var(--rz-text-color); font-size: 0.75rem;">
                        업로드된 파일은 즉시 플레이리스트에 추가 가능합니다
                    </RadzenText>
                </RadzenStack>
                <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Start" Gap="0.5rem">
                    <RadzenIcon Icon="check_circle" Style="font-size: 0.75rem; color: var(--rz-info); margin-top: 0.125rem;" />
                    <RadzenText TextStyle="TextStyle.Caption" class="mb-0" Style="color: var(--rz-text-color); font-size: 0.75rem;">
                        파일명은 자동으로 미디어 이름으로 사용됩니다
                    </RadzenText>
                </RadzenStack>
            </RadzenStack>
        </RadzenStack>
    </RadzenCard>

    <!-- 버튼 영역 -->
    <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.End" Gap="0.75rem" Style="padding-top: 0.5rem;">
        <RadzenButton Text="닫기" 
                      Icon="close" 
                      ButtonStyle="ButtonStyle.Light" 
                      Variant="Variant.Flat"
                      Click="@CloseDialog" 
                      Disabled="@isUploading"
                      Style="min-width: 100px;" />
    </RadzenStack>
</RadzenStack>

<style>
    .media-dialog-modern {
        max-width: 600px;
        margin: 0 auto;
    }

    .header-card {
        background: linear-gradient(135deg, var(--rz-primary-lighter) 0%, var(--rz-base-background-color) 100%);
        border: 1px solid var(--rz-primary-light);
    }

    .icon-wrapper {
        width: 3rem;
        height: 3rem;
        display: flex;
        align-items: center;
        justify-content: center;
        background: var(--rz-base-background-color);
        border-radius: var(--rz-border-radius);
        border: 1px solid var(--rz-primary-light);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    .upload-zone-card {
        border: 2px dashed var(--rz-border-color) !important;
        background: var(--rz-panel-background-color) !important;
        min-height: 180px !important;
        position: relative;
        transition: all 0.3s ease;
        border-radius: var(--rz-border-radius) !important;
    }

    .upload-zone-card:hover {
        border-color: var(--rz-primary) !important;
        background: var(--rz-base-background-color) !important;
        border-style: dashed !important;
        box-shadow: 0 4px 12px rgba(var(--rz-primary-rgb, 52, 152, 219), 0.15) !important;
    }

    .upload-area {
        width: 100%;
        min-height: 180px;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
    }

    /* Corner Decorations */
    .upload-corner {
        position: absolute;
        width: 20px;
        height: 20px;
        border-style: solid;
        border-color: var(--rz-primary);
        opacity: 0.3;
        transition: all 0.3s ease;
    }

    .upload-zone-card:hover .upload-corner {
        opacity: 0.7;
        width: 24px;
        height: 24px;
    }

    .corner-tl {
        top: -2px;
        left: -2px;
        border-width: 2px 0 0 2px;
        border-radius: 6px 0 0 0;
    }

    .corner-tr {
        top: -2px;
        right: -2px;
        border-width: 2px 2px 0 0;
        border-radius: 0 6px 0 0;
    }

    .corner-bl {
        bottom: -2px;
        left: -2px;
        border-width: 0 0 2px 2px;
        border-radius: 0 0 0 6px;
    }

    .corner-br {
        bottom: -2px;
        right: -2px;
        border-width: 0 2px 2px 0;
        border-radius: 0 0 6px 0;
    }

    /* Upload Icon Animation */
    .upload-icon-animated {
        animation: float 3s ease-in-out infinite;
    }

    @@keyframes float {
        0%, 100% { transform: translateY(0px); }
        50% { transform: translateY(-10px); }
    }

    .upload-zone-card:hover .upload-icon-animated {
        animation: float 1.5s ease-in-out infinite, pulse 1.5s ease-in-out infinite;
    }

    @@keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.7; }
    }

    /* Bounce Animation for Drag Over */
    .bounce-animation {
        animation: bounce 0.6s ease infinite;
    }

    @@keyframes bounce {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-15px); }
    }

    .drag-overlay, .upload-progress-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(var(--rz-primary-rgb), 0.95);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 10;
        border-radius: var(--rz-border-radius);
    }

    .upload-progress-overlay {
        background: rgba(0, 0, 0, 0.85);
    }

    .uploaded-files-list {
        max-height: 200px;
        overflow-y: auto;
    }

    .uploaded-files-list::-webkit-scrollbar {
        width: 6px;
    }

    .uploaded-files-list::-webkit-scrollbar-track {
        background: var(--rz-panel-background-color);
        border-radius: 3px;
    }

    .uploaded-files-list::-webkit-scrollbar-thumb {
        background: var(--rz-border-color);
        border-radius: 3px;
    }

    .uploaded-files-list::-webkit-scrollbar-thumb:hover {
        background: var(--rz-primary);
    }
</style>
