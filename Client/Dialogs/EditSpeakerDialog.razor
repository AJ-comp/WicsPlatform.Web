@attribute [Authorize]

<div class="edit-speaker-dialog">
    <div class="dialog-header">
        <RadzenIcon Icon="edit" Style="font-size: 32px; margin-right: 12px;" />
        <RadzenText TextStyle="TextStyle.H5" class="mb-0">스피커 정보 수정</RadzenText>
    </div>

    <div class="dialog-description">
        <RadzenText TextStyle="TextStyle.Body2">
            스피커 정보를 수정합니다. 필요한 항목을 변경한 후 저장 버튼을 클릭하세요.
        </RadzenText>
    </div>

    <RadzenTemplateForm TItem="EditSpeakerFormModel" Data="@model" Submit="@FormSubmit">
        <RadzenAlert Shade="Shade.Lighter" Variant="Variant.Flat" Size="AlertSize.Small"
                     AlertStyle="AlertStyle.Danger" Visible="@errorVisible">
            <RadzenIcon Icon="error_outline" class="me-2" />
            @error
        </RadzenAlert>

        @if (isLoadingData)
        {
            <div class="text-center py-5">
                <RadzenProgressBar Value="100" ShowValue="false" Mode="ProgressBarMode.Indeterminate" Style="width: 40%; height: 8px; margin: 0 auto;" />
                <RadzenText TextStyle="TextStyle.Body1" class="mt-3 mb-0">스피커 정보를 불러오는 중입니다...</RadzenText>
            </div>
        }
        else
        {
            <div class="form-section">
                <div class="form-section-header">
                    <RadzenText TextStyle="TextStyle.Subtitle2" Class="mb-2">기본 정보</RadzenText>
                    <div class="section-divider"></div>
                </div>

                <RadzenRow style="margin-bottom: 1.5rem">
                    <RadzenColumn SizeMD="3">
                        <RadzenLabel Text="스피커명" Component="Name" style="width: 100%" />
                    </RadzenColumn>
                    <RadzenColumn SizeMD="9">
                        <div class="custom-input-container">
                            <RadzenIcon Icon="speaker_phone" />
                            <RadzenTextBox style="display: block; width: 100%; padding-left: 35px;"
                                           Placeholder="스피커 이름 입력..."
                                           @bind-Value="@(model.Name)" Name="Name" />
                        </div>
                        <RadzenRequiredValidator Component="Name" Text="스피커명은 필수입니다" Style="position: absolute" />
                    </RadzenColumn>
                </RadzenRow>

                <RadzenRow style="margin-bottom: 1.5rem">
                    <RadzenColumn SizeMD="3">
                        <RadzenLabel Text="IP 주소" Component="Ip" style="width: 100%" />
                    </RadzenColumn>
                    <RadzenColumn SizeMD="9">
                        <div class="custom-input-container">
                            <RadzenIcon Icon="router" />
                            <RadzenTextBox style="display: block; width: 100%; padding-left: 35px;"
                                           Placeholder="IP 주소 입력 (예: 192.168.0.1)..."
                                           @bind-Value="@(model.Ip)" Name="Ip" />
                        </div>
                        <RadzenRequiredValidator Component="Ip" Text="IP 주소는 필수입니다" Style="position: absolute" />
                        <RadzenRegexValidator Component="Ip" Text="올바른 IP 주소 형식이 아닙니다"
                                              Pattern="^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$"
                                              Style="position: absolute" />
                    </RadzenColumn>
                </RadzenRow>

                <RadzenRow style="margin-bottom: 1.5rem">
                    <RadzenColumn SizeMD="3">
                        <RadzenLabel Text="모델명" Component="Model" style="width: 100%" />
                    </RadzenColumn>
                    <RadzenColumn SizeMD="9">
                        <div class="custom-input-container">
                            <RadzenIcon Icon="devices" />
                            <RadzenTextBox style="display: block; width: 100%; padding-left: 35px;"
                                           Placeholder="모델명 입력..."
                                           @bind-Value="@(model.Model)" Name="Model" />
                        </div>
                        <RadzenRequiredValidator Component="Model" Text="모델명은 필수입니다" Style="position: absolute" />
                    </RadzenColumn>
                </RadzenRow>

                <RadzenRow style="margin-bottom: 1.5rem">
                    <RadzenColumn SizeMD="3">
                        <RadzenLabel Text="비밀번호" Component="Password" style="width: 100%" />
                    </RadzenColumn>
                    <RadzenColumn SizeMD="9">
                        <div class="custom-input-container">
                            <RadzenIcon Icon="vpn_key" />
                            <RadzenPassword style="display: block; width: 100%; padding-left: 35px;"
                                            Placeholder="비밀번호 입력 (변경하지 않으려면 비워두세요)..."
                                            @bind-Value="@(model.Password)" Name="Password" />
                        </div>
                        <RadzenText TextStyle="TextStyle.Caption" class="text-muted">
                            비밀번호를 변경하지 않으려면 비워두세요
                        </RadzenText>
                    </RadzenColumn>
                </RadzenRow>

                <RadzenRow style="margin-bottom: 1.5rem">
                    <RadzenColumn SizeMD="3">
                        <RadzenLabel Text="설치 위치" Component="Location" style="width: 100%" />
                    </RadzenColumn>
                    <RadzenColumn SizeMD="9">
                        <div class="custom-input-container">
                            <RadzenIcon Icon="place" />
                            <RadzenTextBox style="display: block; width: 100%; padding-left: 35px;"
                                           Placeholder="설치 위치 입력..."
                                           @bind-Value="@(model.Location)" Name="Location" />
                        </div>
                        <RadzenRequiredValidator Component="Location" Text="설치 위치는 필수입니다" Style="position: absolute" />
                    </RadzenColumn>
                </RadzenRow>

                <RadzenRow style="margin-bottom: 1.5rem">
                    <RadzenColumn SizeMD="3">
                        <RadzenLabel Text="상태" Component="State" style="width: 100%" />
                    </RadzenColumn>
                    <RadzenColumn SizeMD="9">
                        <div class="custom-input-container">
                            <RadzenIcon Icon="power_settings_new" />
                            <RadzenDropDown style="display: block; width: 100%; padding-left: 35px;"
                                            @bind-Value="@(model.State)"
                                            Data="@stateOptions"
                                            TextProperty="Text"
                                            ValueProperty="Value"
                                            Name="State" />
                        </div>
                    </RadzenColumn>
                </RadzenRow>

                <RadzenRow style="margin-bottom: 1.5rem">
                    <RadzenColumn SizeMD="3">
                        <RadzenLabel Text="생성일" style="width: 100%" />
                    </RadzenColumn>
                    <RadzenColumn SizeMD="9">
                        <RadzenText TextStyle="TextStyle.Body1">
                            @(originalSpeaker?.CreatedAt.ToString("yyyy-MM-dd HH:mm:ss") ?? "-")
                        </RadzenText>
                    </RadzenColumn>
                </RadzenRow>

                <RadzenRow style="margin-bottom: 1.5rem">
                    <RadzenColumn SizeMD="3">
                        <RadzenLabel Text="최종 수정일" style="width: 100%" />
                    </RadzenColumn>
                    <RadzenColumn SizeMD="9">
                        <RadzenText TextStyle="TextStyle.Body1">
                            @(originalSpeaker?.UpdatedAt.ToString("yyyy-MM-dd HH:mm:ss") ?? "-")
                        </RadzenText>
                    </RadzenColumn>
                </RadzenRow>
            </div>
        }

        <div class="form-actions">
            <RadzenButton ButtonStyle="ButtonStyle.Light" Text="취소" Click="@CancelClick" Variant="Variant.Flat" class="me-2" Disabled="@isProcessing" />
            @if (isProcessing)
            {
                <RadzenButton ButtonType="ButtonType.Submit" Text="처리 중..." Icon="sync" IconSpin="true"
                              Disabled="true" Variant="Variant.Flat" ButtonStyle="ButtonStyle.Primary" />
            }
            else
            {
                <RadzenButton ButtonType="ButtonType.Submit" Icon="save" Text="저장"
                              Variant="Variant.Flat" ButtonStyle="ButtonStyle.Primary"
                              Disabled="@isLoadingData" />
            }
        </div>
    </RadzenTemplateForm>
</div>

<style>
    .edit-speaker-dialog {
        padding: 0;
    }

    .dialog-header {
        display: flex;
        align-items: center;
        margin-bottom: 16px;
    }

    .dialog-description {
        margin-bottom: 24px;
        padding-bottom: 16px;
        border-bottom: 1px solid var(--rz-border-light);
    }

    .form-section {
        margin-bottom: 20px;
    }

    .form-section-header {
        margin-bottom: 16px;
    }

    .section-divider {
        height: 2px;
        background: var(--rz-border-light);
        width: 100%;
        margin-top: 4px;
    }

    .custom-input-container {
        position: relative;
    }

        .custom-input-container .rz-icon {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            z-index: 1;
        }

    .form-actions {
        display: flex;
        justify-content: flex-end;
        padding-top: 16px;
        margin-top: 16px;
        border-top: 1px solid var(--rz-border-light);
    }

    /* 스크롤바 스타일 수정 - 테마와 일치하도록 */
    ::-webkit-scrollbar {
        width: 10px;
        height: 10px;
    }

    ::-webkit-scrollbar-track {
        background: var(--rz-base-200);
        border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb {
        background: var(--rz-secondary-dark);
        border-radius: 4px;
    }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--rz-secondary-darker);
        }

    .rz-dialog-content::-webkit-scrollbar {
        width: 10px;
        height: 10px;
    }

    .rz-dialog-content::-webkit-scrollbar-track {
        background: var(--rz-base-200);
        border-radius: 4px;
    }

    .rz-dialog-content::-webkit-scrollbar-thumb {
        background: var(--rz-secondary-dark);
        border-radius: 4px;
    }

        .rz-dialog-content::-webkit-scrollbar-thumb:hover {
            background: var(--rz-secondary-darker);
        }
</style>
