@attribute [Authorize]

<RadzenStack Gap="1rem" Style="width: 100%;">
    <!-- 폼 섹션 -->
    <RadzenTemplateForm TItem="ChannelFormModel" Data="@model" Submit="@FormSubmit">
        <!-- 에러 알림 -->
        @if (errorVisible)
        {
            <RadzenAlert AlertStyle="AlertStyle.Danger"
                         Variant="Variant.Flat"
                         Size="AlertSize.Small"
                         class="error-alert">
                <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.5rem">
                    <RadzenIcon Icon="error_outline" />
                    <RadzenText TextStyle="TextStyle.Caption">@error</RadzenText>
                </RadzenStack>
            </RadzenAlert>
        }

        <!-- 기본 정보 섹션 -->
        <RadzenCard class="section-card">
            <RadzenStack Gap="1rem">
                <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.5rem" class="section-header">
                    <RadzenIcon Icon="info" class="section-icon primary" />
                    <RadzenText TextStyle="TextStyle.Subtitle2" class="section-title">기본 정보</RadzenText>
                </RadzenStack>

                <!-- 채널명 필드 -->
                <RadzenRow Gap="0.5rem">
                    <RadzenColumn Size="12" SizeMD="12">
                        <RadzenFormField Text="채널명" Variant="Variant.Outlined" class="form-field">
                            <ChildContent>
                                <RadzenTextBox @bind-Value="@model.Name"
                                               Placeholder="예: 1층 로비 방송"
                                               Name="Name"
                                               class="input-field" />
                            </ChildContent>
                            <Helper>
                                <RadzenText TextStyle="TextStyle.Caption" class="field-hint">
                                    <RadzenIcon Icon="label" class="hint-icon" />
                                    채널을 쉽게 식별할 수 있는 이름을 입력하세요
                                </RadzenText>
                            </Helper>
                        </RadzenFormField>
                        <RadzenRequiredValidator Component="Name"
                                                 Text="채널명은 필수 입력 항목입니다" />
                    </RadzenColumn>
                </RadzenRow>

                <!-- 설명 필드 -->
                <RadzenRow Gap="0.5rem">
                    <RadzenColumn Size="12" SizeMD="12">
                        <RadzenFormField Text="설명 (선택)" Variant="Variant.Outlined" class="form-field">
                            <ChildContent>
                                <RadzenTextArea @bind-Value="@model.Description"
                                                Rows="2"
                                                Placeholder="채널의 용도나 특징을 간단히 설명해주세요"
                                                Name="Description"
                                                class="input-field" />
                            </ChildContent>
                            <Helper>
                                <RadzenText TextStyle="TextStyle.Caption" class="field-hint">
                                    <RadzenIcon Icon="description" class="hint-icon" />
                                    채널의 목적이나 사용 위치 등을 입력할 수 있습니다
                                </RadzenText>
                            </Helper>
                        </RadzenFormField>
                    </RadzenColumn>
                </RadzenRow>
            </RadzenStack>
        </RadzenCard>

        <!-- 채널 설정 및 오디오 설정 섹션 -->
        <RadzenCard class="section-card">
            <RadzenStack Gap="1rem">
                <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.5rem" class="section-header">
                    <RadzenIcon Icon="settings" class="section-icon primary" />
                    <RadzenText TextStyle="TextStyle.Subtitle2" class="section-title">채널 설정 및 오디오 설정</RadzenText>
                </RadzenStack>

                <!-- 4개 필드를 한 줄에 배치 -->
                <RadzenRow Gap="0.5rem">
                    <!-- 채널 타입 -->
                    <RadzenColumn Size="4" SizeMD="3">
                        <RadzenFormField Text="채널 타입" Variant="Variant.Outlined" class="form-field compact-field">
                            <ChildContent>
                                <RadzenDropDown @bind-Value="@model.Type"
                                                Data="@channelTypes"
                                                TextProperty="Text"
                                                ValueProperty="Value"
                                                Change="@OnChannelTypeChanged"
                                                Name="Type"
                                                class="input-field compact-input small-combo" />
                            </ChildContent>
                            <Helper>
                                <RadzenText TextStyle="TextStyle.Caption" class="field-hint compact-hint">
                                    <RadzenIcon Icon="category" class="hint-icon" />
                                    방송 유형
                                </RadzenText>
                            </Helper>
                        </RadzenFormField>
                    </RadzenColumn>

                    <!-- 우선순위 -->
                    <RadzenColumn Size="3" SizeMD="2">
                        <RadzenFormField Text="우선순위" Variant="Variant.Outlined" class="form-field compact-field">
                            <ChildContent>
                                <RadzenNumeric @bind-Value="@model.Priority"
                                               Min="0"
                                               Max="255"
                                               ShowUpDown="true"
                                               Name="Priority"
                                               class="input-field compact-input small-combo priority-input" />
                            </ChildContent>
                            <Helper>
                                <RadzenText TextStyle="TextStyle.Caption" class="field-hint compact-hint">
                                    <RadzenIcon Icon="priority_high" class="hint-icon" />
                                    0~255
                                </RadzenText>
                            </Helper>
                        </RadzenFormField>
                        <RadzenRequiredValidator Component="Priority"
                                                 Text="우선순위는 필수 입력 항목입니다" />
                        <RadzenNumericRangeValidator Component="Priority"
                                                     Min="0"
                                                     Max="255"
                                                     Text="우선순위는 0~255 사이의 값이어야 합니다" />
                    </RadzenColumn>

                    <!-- 샘플레이트 -->
                    <RadzenColumn Size="4" SizeMD="4">
                        <RadzenFormField Text="샘플레이트" Variant="Variant.Outlined" class="form-field compact-field">
                            <ChildContent>
                                <RadzenDropDown @bind-Value="@model.SamplingRate"
                                                Data="@sampleRates"
                                                TextProperty="Text"
                                                ValueProperty="Value"
                                                Name="SamplingRate"
                                                class="input-field compact-input small-combo" />
                            </ChildContent>
                            <Helper>
                                <RadzenText TextStyle="TextStyle.Caption" class="field-hint compact-hint">
                                    <RadzenIcon Icon="graphic_eq" class="hint-icon" />
                                    오디오 품질
                                </RadzenText>
                            </Helper>
                        </RadzenFormField>
                    </RadzenColumn>

                    <!-- 오디오 채널 -->
                    <RadzenColumn Size="5" SizeMD="3">
                        <RadzenFormField Text="오디오 채널" Variant="Variant.Outlined" class="form-field compact-field">
                            <ChildContent>
                                <RadzenDropDown @bind-Value="@model.ChannelCount"
                                                Data="@audioChannels"
                                                TextProperty="Text"
                                                ValueProperty="Value"
                                                Name="ChannelCount"
                                                class="input-field compact-input small-combo" />
                            </ChildContent>
                            <Helper>
                                <RadzenText TextStyle="TextStyle.Caption" class="field-hint compact-hint">
                                    <RadzenIcon Icon="surround_sound" class="hint-icon" />
                                    모노/스테레오
                                </RadzenText>
                            </Helper>
                        </RadzenFormField>
                    </RadzenColumn>
                </RadzenRow>
            </RadzenStack>
        </RadzenCard>

        <!-- 정보 카드 -->
        <RadzenCard class="info-card">
            <RadzenStack Gap="0.75rem">
                <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.5rem">
                    <RadzenIcon Icon="lightbulb" class="info-icon" />
                    <RadzenText TextStyle="TextStyle.Subtitle2" class="info-title">채널 생성 안내</RadzenText>
                </RadzenStack>
                <RadzenStack Gap="0.5rem" class="info-list">
                    <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Start" Gap="0.5rem">
                        <RadzenIcon Icon="check_circle" class="check-icon" />
                        <RadzenText TextStyle="TextStyle.Caption">생성 후 스피커와 미디어를 연결할 수 있습니다</RadzenText>
                    </RadzenStack>
                    <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Start" Gap="0.5rem">
                        <RadzenIcon Icon="check_circle" class="check-icon" />
                        <RadzenText TextStyle="TextStyle.Caption">우선순위가 높은(숫자가 작은) 채널이 방송 충돌 시 우선권을 가집니다</RadzenText>
                    </RadzenStack>
                    <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Start" Gap="0.5rem">
                        <RadzenIcon Icon="check_circle" class="check-icon" />
                        <RadzenText TextStyle="TextStyle.Caption">긴급 방송 > 공지 방송 > 일반 방송 > 음악 방송 순으로 우선권이 있습니다</RadzenText>
                    </RadzenStack>
                    <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Start" Gap="0.5rem">
                        <RadzenIcon Icon="check_circle" class="check-icon" />
                        <RadzenText TextStyle="TextStyle.Caption">오디오 설정은 방송 품질에 영향을 줍니다</RadzenText>
                    </RadzenStack>
                    <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Start" Gap="0.5rem">
                        <RadzenIcon Icon="check_circle" class="check-icon" />
                        <RadzenText TextStyle="TextStyle.Caption">생성된 채널은 언제든지 수정 가능합니다</RadzenText>
                    </RadzenStack>
                </RadzenStack>
            </RadzenStack>
        </RadzenCard>

        <!-- 액션 버튼 섹션 -->
        <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.End" AlignItems="AlignItems.Center" Gap="0.75rem" class="dialog-actions">
            <RadzenButton ButtonStyle="ButtonStyle.Light"
                          Text="취소"
                          Icon="close"
                          Click="@CancelClick"
                          Size="ButtonSize.Medium"
                          Disabled="@isProcessing" />
            @if (isProcessing)
            {
                <RadzenButton ButtonType="ButtonType.Submit"
                              Text="생성 중..."
                              Icon="sync"
                              ButtonStyle="ButtonStyle.Primary"
                              Size="ButtonSize.Medium"
                              IsBusy="true"
                              Disabled="true" />
            }
            else
            {
                <RadzenButton ButtonType="ButtonType.Submit"
                              Icon="add_circle"
                              Text="채널 생성"
                              ButtonStyle="ButtonStyle.Primary"
                              Size="ButtonSize.Medium" />
            }
        </RadzenStack>
    </RadzenTemplateForm>
</RadzenStack>

<style>
    /* 에러 알림 */
    .error-alert {
        padding: 0.75rem !important;
        border-radius: var(--rz-border-radius) !important;
    }

    /* 섹션 카드 */
    .section-card {
        padding: 1.25rem !important;
        background: rgba(var(--rz-primary-rgb), 0.03) !important;
        border: 1px solid var(--rz-border-color) !important;
        border-radius: var(--rz-border-radius) !important;
        transition: all 0.2s ease;
    }

        .section-card:hover {
            background: rgba(var(--rz-primary-rgb), 0.05) !important;
            box-shadow: var(--rz-shadow-2) !important;
        }

    /* 섹션 헤더 */
    .section-header {
        padding-bottom: 0.75rem;
        border-bottom: 2px solid rgba(var(--rz-primary-rgb), 0.2);
    }

    .section-icon {
        font-size: 1.125rem !important;
    }

        .section-icon.primary {
            color: var(--rz-primary) !important;
        }

    .section-title {
        margin: 0 !important;
        font-weight: 600 !important;
        color: var(--rz-text-color) !important;
    }

    /* 서브섹션 헤더 */
    .subsection-header {
        padding-bottom: 0.5rem;
        margin-bottom: 0.5rem;
        border-bottom: 1px solid rgba(var(--rz-primary-rgb), 0.15);
    }

    .subsection-icon {
        font-size: 1rem !important;
        color: var(--rz-primary) !important;
    }

    .subsection-title-large {
        margin: 0 !important;
        font-weight: 600 !important;
        color: var(--rz-text-color) !important;
        font-size: 1rem !important;
    }

    /* 폼 필드 */
    .form-field {
        width: 100%;
    }

    .input-field {
        width: 100% !important;
        font-size: 0.875rem !important;
    }

    /* Compact 필드 스타일 */
    .compact-field {
        margin-bottom: 0 !important;
    }

    .compact-input {
        width: 100% !important;
    }

    /* 작은 콤보박스 */
    .small-combo {
        width: 100% !important;
        display: block !important;
    }

    /* 우선순위 입력 필드 */
    .priority-input {
        width: 100% !important;
        display: block !important;
    }

    .field-hint {
        display: flex;
        align-items: center;
        gap: 0.375rem;
        margin-top: 0.25rem;
        color: var(--rz-text-secondary-color) !important;
        font-size: 0.75rem !important;
    }

    /* Compact 힌트 */
    .compact-hint {
        font-size: 0.7rem !important;
    }

    .hint-icon {
        font-size: 0.75rem !important;
        color: var(--rz-text-tertiary-color) !important;
    }

    /* 정보 카드 */
    .info-card {
        padding: 1.25rem !important;
        background: rgba(var(--rz-info-rgb), 0.05) !important;
        border: 1px solid rgba(var(--rz-info-rgb), 0.2) !important;
        border-radius: var(--rz-border-radius) !important;
    }

    .info-icon {
        font-size: 1.25rem !important;
        color: var(--rz-info) !important;
    }

    .info-title {
        margin: 0 !important;
        font-weight: 600 !important;
        color: var(--rz-text-color) !important;
    }

    .info-list {
        margin: 0 !important;
    }

    .check-icon {
        font-size: 0.875rem !important;
        color: var(--rz-success) !important;
        flex-shrink: 0;
        margin-top: 2px;
    }

    /* 액션 버튼 섹션 */
    .dialog-actions {
        padding-top: 1rem;
        border-top: 1px solid var(--rz-border-color);
        margin-right: 0.5rem;
    }

    /* 애니메이션 */
    @@keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(-10px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .section-card {
        animation: fadeIn 0.3s ease-out;
    }
</style>
